# Chapter8 - 기능이동

> 좋은 코드와 좋은 좋은 설계의 시작 포인트 - 응집도<br />
> **서로 밀접하게 연관 있는** 속성(data)와 행동(method)이 **함께 뭉쳐있는(모듈, 클래스, 함수)** 정도를 나타냄

서로 다른 두개 이상의 모듈 또는 클래스가 밀접하게 연결되어있는 것을 스파게티 코드<br />
즉, **high coupling**이라고 한다.

다른 코드와 결합되는 부분은 작업시 피할 수 없는 부분이다.<br />
하지만 이 부분을 최소하하여 모듈 내부의 응집도는 높이고 외부 모듈의 커플링을 낮춰야 다른 모듈의 변화에 크게 영향을 받지 않아 유지보수하기 편하다.

**리팩토링의 원칙 되새김**
- 함수 하나당, **한가지의 일**을 수행하도록 만들어주자
- 모듈/클래스 하나당, **한가지의 책임**을 가지도록 하자.


## 8-1 함수 옮기기
모듈성이 높은 코드가 좋은 소프트웨어를 설계한 것이다.

모듈성 - 작은 일부분만 이해하더라도 전체 코드를 이해할 수 있도록 해주는 능력

모듈성을 높이기 위해서는
1. 연관된 요소들을 함께 묶기
2. 요소의 연결 관계를 쉽게 찾고 이해할 수 있도록 하기

함수 옮기기 위한 결정 요소
1. 현재 컨텍스트와 후보 컨텍스트를 둘러보기
2. 대상 함수를 호출하는 함수가 무엇인가?
3. 대상 함수가 호출하는 함수들은 무엇이 있는가?
4. 대상 함수가 사용하는 데이터는 무엇인가?

## 8-2 필드 옮기기
프로그램의 상당 부분이 동작을 구현하는 코드로 이뤄지지만 프로그램의 진짜는 데이터 구조이다.

적합한 데이터 구조로 만들어진 동작 코드는 자연스럽고 단순해진다.

데이터 구조가 적절치 않았음을 느꼈을때는 곧바로 수정해야한다. 그렇지 않는다면 훗날 작성하게 될 코드를 더욱 복잡하게 만들어버린다.

1. 함수에 건네지는 데이터 조각들은 상호 관계가 명확하게 드러나도록 한 레코드에 담자.(하나의 헤코드를 변경하려 할 때 다른 레코드의 필드까지 변경해야한다면 그것은 잘못된 위치의 필드라는 신호이다. 얼른 한 번만 갱신해도 되는 다른 위치로 옮기자.)


## 8-3 문장을 함수로 옮기기

반복되는 부분이 있다면 함수로 따로 빼서 작업을 해준다면 해당 함수만 수정하면 된다는 이점이 생겨 유지보수성이 높아진다.

## 8-4 문장을 호출한 곳으로 옮기기

대부분이 작업 초기에는 응집도가 높고 한가지 일만 수행하는 함수를 만든다. 하지만 프로젝트가 진행될수록 해당하는 함수는 둘이상의 분기처리를 통해 다른일을 수행하게 바뀔 경우가 생기기 마련이다.
이럴경우 달라진 동작을 함수에서 꺼내 해당 호출자로 옮겨야 한다.

달라지는 동작을 함수의 시작 또는 끝으로 옮긴 후 문장을 호출한 곳으로 옮겨서 리팩토링을 적용하면 된다.

작은 변경의 경우
문장을 호출한 곳으로 옮기는 것으로 충분하다.

호출자와 호출 대상의 경계가 완전히 다르다면 함수 인라인하기를 선수행한다음 문장 슬라이드 또는 함수 추출하기로 더 적합한 리팩토링 방법을 찾아야한다.

## 8-5 인라인 코드를 함수 호출로 바꾸기

## 8-6 문장 슬라이드하기
관련된 코드들이 가까이 모여 있는 것이 유지보수하기 좋다.
가까이 모으기 위해 문장 슬라이드라는 리팩토링 기술을 사용한다.

관련 코드들이 모여있지 않다면 함수 추출과 같은 리팩토링 기술을 사용하는데 어려움이 있다.

코드를 옮길때는 작게 나눠 시도해보거나, 이동 거리를 줄여서 한다.

코드 조각을 슬라이드할 때 체크사항
1. 무엇을 슬라이드 할지
2. 슬라이드 할 수 있는지 여부(부수효과가 있는지)

## 8-7 반복문 쪼개기

반복문 하나에 두가지 이상의 일을 수행하는 경우가 있다.
이 경우 주로 구조체를 반환하거나 지역변수를 활용한다.
그러므로 해당 반복문을 수정하기 위해서 동작 원리를 잘 이해하고 있어야한다.

만약 반복문이 분리되어 있다면 한가지 기능에 초점이 맞춰져서 리팩토링하기가 수월해질 것이다.

이렇게 반복문을 쪼개게 된다면 성능상에 이슈가 있다고 생각할 수도 있지만, **리팩토링과 최적화는 구분하자**

## 8-8 반복문을 파이프라인으로 바꾸기

## 8-9 죽은 코드 제거하기

